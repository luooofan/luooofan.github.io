---
title: 服务器配置
date: 2021-01-16 13:54:21
categories: [Server]
tags: [Linux, 记录]
description: 买下腾讯云服务器之后的几项配置
keywords: 
cover: false
---
# 服务器配置
买下腾讯云服务器之后的几项配置

## 一、用户与登录方面


### 1.1 开放22端口


### 1.2 新用户


- 使用`passwd`命令设定`root`用户密码

- 使用`adduser`命令添加新用户`adduser luooofan`

- 使用`passwd`命令设定新用户密码 `passwd luooofan`

- 新创建的用户不能使用`sudo`命令，需要给它添加授权

  - `sudo`命令的授权管理是在`sudoers`文件里的

  - 找到文件位置 `whereis sudoers`

  - 查看权限并添加写权限 `chmod -v u+w /etc/sudoers`

  - 使用`vim`编辑：

    ```bash
    ## Allow root to run any commands anywher  
    root    ALL=(ALL)       ALL  
    luooofan  ALL=(ALL)       ALL  #这个是新增的用户
    ```

  - 保存退出，收回写权限 `chmod -v u-w /etc/sudoers`

  - 把最后的`ALL`修改为`NOPASSWD:ALL`可以不输入root用户密码

参考[CentOS 7中添加一个新用户并授权](https://www.jianshu.com/p/27a77e3fc573)

### 1.3 登录设置

设定SSH密钥登录，禁用密码登录

- 可以使用腾讯云辅助实现，下载密钥文件`TencentCloud.pem`（自定义命名）
- 也可以手工配置，参考[【SSH】使用SSH登录远程主机，并禁用密码登录](https://cloud.tencent.com/developer/article/1335758?from=information.detail.%E6%80%8E%E4%B9%88%E7%A6%81%E7%94%A8%E5%AF%86%E7%A0%81%E7%99%BB%E9%99%86)
- 本质上都是使用`ssh`命令和配置`/etc/ssh/sshd_config`

注意，该过程把`root`用户的登录方式改为密钥登录，同时禁用了所有用户的密码登录，所以要在**禁用密码登录之前**把其他用户的密钥也设置好

也可以先登录`root`用户然后`su luooofan`切换为新用户

### 1.4 配置安全组规则

入站规则：在已经开放22端口的基础上开放80，443等端口（按需开放）
出站规则：全放通

### 1.5 安装zsh，oh-my-zsh配置美化
参考[Linux | zsh+on-my-zsh 配置](https://blog.zuiyu1818.cn/posts/zsh.html)


## 二、配置VS code SSH

参考[官方文档：Remote development over SSH](https://code.visualstudio.com/docs/remote/ssh-tutorial)

有几个注意点：

- 可以直接在配置文件`"C:\...\.ssh\config"`中进行相关配置，然后直接使用密钥连接
  - 配置项：Host、HostName、User、IdentityFile
  - 如果要使用腾讯云生成的.pem密钥文件的话，需要将该文件放在固定的位置，一般放在SSH的配置文件所在的文件夹中就可以，然后在IdentityFile后写该密钥文件的位置
- 在有关Remote-SSH插件的众多配置选项中，当前环境下不能勾选`Show Login Terminal`这个选项，勾选了的话，ssh连上之后一开bash连接就断
- 想看连接的具体信息的话在输出窗口中选择Remote - SSH来查看具体信息，可以进一步了解，以及排错
- 如果配置出现问题，无法解决，可以利用其他方式登录到云主机上后，删掉目录下的`.vscode-server`文件夹然后重新连接
- `Remote Server Listen On Socket`这个选项暂时不勾选



## 三、 搭建ghost博客平台

### 3.1 Ghost 简介

`Ghost`是一款优秀的开源博客平台，基于 Node 构建，相比于 Wordpress，Ghost 性能优异、界面简洁，支持在线预览和在线写作。Ghost 属于动态博客，区分前台和后台，后台负责写作、发布文章，前台负责博客页面展示，对比 Hexo 等静态博客，Ghost 不需要编译生成页面，可以随时随地在后台进行写作发布。

### 3.2 过程

参考[Ghost 博客搭建笔记](https://strongduanmu.com/ghost-blog-install-note/)，[Ghost 博客升级指南](https://halfrost.com/ghost_update/)

- 创建新用户（用之前创建的luoooofan就好）
- 安装Node
- 安装Nginx
- 安装Mysql
- 安装Ghost

几个注意点：

- 将yum设置成国内源：`curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo`
  可以先备份，改为国内源后运行`yum makecache`生成缓存

- Mysql尽量下载5.7.x版本，如果版本装错，参考[Centos7 完全卸载mysql](https://www.jianshu.com/p/ef58fb333cd6)

- 配置ghost时如果出现`/bin/sh -c sudo -S -p '#node-sudo-passwd#'  systemctl is-active ghost_localhost` ，可以运行

  ```bash
  sudo ln -sf /usr/lib/systemd/system/ghost_localhost.service /etc/systemd/system/ghost_localhost.service
  sudo systemctl stop ghost_localhost
  sudo systemctl start ghost_localhost
  ```

  参考[Stackoverflow:Command failed when running ghost start](https://stackoverflow.com/questions/48855211/command-failed-when-running-ghost-start)

- 可以更换ghost主题：[Github:halfrost:Prometheus](https://github.com/halfrost/Prometheus)


## 四、搭建个人网盘
使用Cloudreve搭建个人网盘，并使用aria2实现离线下载功能
[项目地址](https://github.com/cloudreve/Cloudreve)
[官方文档](https://docs.cloudreve.org)
- 使用wget命令将可执行程序包下载到本地
- 解压包，赋予执行权限
- 修改配置文件，使用mysql数据库
- 直接启动，记住管理员账号和密码，然后ctrl+c退出
- 配置进程守护 systemd
- 使用systemctl启动Cloudereve
- 云服务器开放指定端口
- 浏览器登录进行具体配置
- 参考[centos安装aria2](https://cloud.tencent.com/developer/article/1142142)安装配置aria2，可以手动编译，也可以配置源后直接yum安装
- 按照[Cloudreve相关文档](https://docs.cloudreve.org/use/aria2)配置离线下载
- 停止Cloudreve服务，先运行aria2服务，再运行Cloudreve服务
- 浏览器登录测试具体功能，可配置Webdav

